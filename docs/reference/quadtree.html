<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create a Quadtree from a raster or matrix — quadtree • quadtree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create a Quadtree from a raster or matrix — quadtree"><meta property="og:description" content="Creates a Quadtree from a 
SpatRaster,
RasterLayer or a matrix."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quadtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/quadtree-creation.html">Creating Quadtrees</a>
    </li>
    <li>
      <a href="../articles/quadtree-usage.html">Using Quadtrees</a>
    </li>
    <li>
      <a href="../articles/quadtree-lcp.html">Finding LCPs</a>
    </li>
    <li>
      <a href="../articles/quadtree-code.html">Code Details</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dfriend21/quadtree/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a <code>Quadtree</code> from a raster or matrix</h1>
    <small class="dont-index">Source: <a href="https://github.com/dfriend21/quadtree/blob/HEAD/R/quadtree.R" class="external-link"><code>R/quadtree.R</code></a></small>
    <div class="hidden name"><code>quadtree.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates a <code><a href="Quadtree-class.html">Quadtree</a></code> from a 
<code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code>,
<code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">RasterLayer</a></code> or a matrix.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for ANY</span></span>
<span><span class="fu">quadtree</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  split_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  split_method <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>  split_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  split_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  split_if_any_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  split_if_all_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  combine_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  combine_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  combine_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  max_cell_length <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_cell_length <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adj_type <span class="op">=</span> <span class="st">"expand"</span>,</span>
<span>  resample_n_side <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resample_pad_nas <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  projection <span class="op">=</span> <span class="st">""</span>,</span>
<span>  proj4string <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  template_quadtree <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a <code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">RasterLayer</a></code>,
<code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code>, or
<code>matrix</code>. If <code>x</code> is a <code>matrix</code>, the <code>extent</code> and
<code>projection</code> parameters can be used to set the extent and projection
of the quadtree. If <code>x</code> is a
<code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">RasterLayer</a></code> or
<code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code>, the extent and
projection are derived from the raster.</p></dd>


<dt>split_threshold</dt>
<dd><p>numeric; the threshold value used by the split method
(specified by <code>split_method</code>) to decide whether to split a quadrant.
If the value for a quadrant is greater than this value, it is split into
its four child cells. If <code>split_method</code> is <code>"custom"</code>, this
parameter is ignored.</p></dd>


<dt>split_method</dt>
<dd><p>character; one of <code>"range"</code> (the default),
<code>"sd"</code> (standard deviation), <code>"cv"</code> (coefficient of variation) or
<code>"custom"</code>. Determines the method used for calculating the value used
to determine whether or not to split a quadrant (this calculated value is
compared with <code>split_threshold</code> to decide whether to split a cell). If
<code>"custom"</code>, a function must be supplied to <code>split_fun</code>. See
'Details' for more.</p></dd>


<dt>split_fun</dt>
<dd><p>function; function used on each quadrant to decide whether
or not to split the quadrant. Only used when <code>split_method</code> is
<code>"custom"</code>. Must take two arguments, <code>vals</code> (a numeric vector of
the cell values in a quadrant) and <code>args</code> (a named list of arguments
used within the function), and must output <code>TRUE</code> if the quadrant is
to be split and <code>FALSE</code> otherwise. It must be able to handle <code>NA</code>
values - if <code>NA</code> is ever returned, an error will occur.</p></dd>


<dt>split_args</dt>
<dd><p>list; named list that contains the arguments needed by
<code>split_fun</code>. This list is given to the <code>args</code> parameter of
<code>split_fun</code>.</p></dd>


<dt>split_if_any_na</dt>
<dd><p>boolean; if <code>TRUE</code> (the default), a quadrant is
automatically split if any of the values within the quadrant are <code>NA</code>.</p></dd>


<dt>split_if_all_na</dt>
<dd><p>boolean; if <code>FALSE</code> (the default), a quadrant
that contains only <code>NA</code> values is not split. If <code>TRUE</code>, quadrants
that contain all <code>NA</code> values are split to the smallest possible cell
size.</p></dd>


<dt>combine_method</dt>
<dd><p>character; one of <code>"mean"</code>, <code>"median"</code>,
<code>"min"</code>, <code>"max"</code>, or <code>"custom"</code>. Determines the method used
for aggregating the values of multiple cells into a single value for a
larger, aggregated cell. Default is <code>"mean"</code>. If <code>"custom"</code>, a
function must be supplied to <code>combine_fun</code>.</p></dd>


<dt>combine_fun</dt>
<dd><p>function; function used to calculate the value of a
quadrant. Only used when <code>combine_method</code> is <code>"custom"</code>. Must
take two arguments, <code>vals</code> (a numeric vector of the cell values in a
quadrant) and <code>args</code> (a named list of arguments used within the
function), and must output a single numeric value, which will be used as
the cell value.</p></dd>


<dt>combine_args</dt>
<dd><p>list; named list that contains the arguments needed by
<code>combine_fun</code>. This list is given to the <code>args</code> parameter of
<code>combine_fun</code>.</p></dd>


<dt>max_cell_length</dt>
<dd><p>numeric; the maximum side length allowed for a
quadtree cell. Any quadrants larger than <code>max_cell_length</code> will
automatically be split. If <code>NULL</code> (the default) no restrictions are
placed on the maximum cell length.</p></dd>


<dt>min_cell_length</dt>
<dd><p>numeric; the minimum side length allowed for a
quadtree cell. A quadrant will not be split if its children would be
smaller than <code>min_cell_length</code>. If <code>NULL</code> (the default) no
restrictions are placed on the minimum cell length.</p></dd>


<dt>adj_type</dt>
<dd><p>character; one of <code>"expand"</code> (the default),
<code>"resample"</code>, or <code>"none"</code>. Specifies the method used to adjust
<code>x</code> so that its dimensions are suitable for quadtree creation (i.e.
square and with the number of cells in each direction being a power of 2).
See 'Details' for more on the two methods of adjustment.</p></dd>


<dt>resample_n_side</dt>
<dd><p>integer; if <code>adj_type</code> is <code>'resample'</code>, this
number is used to determine the dimensions to resample the raster to.</p></dd>


<dt>resample_pad_nas</dt>
<dd><p>boolean; only applicable if <code>adj_type</code> is
<code>'resample'</code>. If <code>TRUE</code> (the default), <code>NA</code>s are added to
the shorter side of the raster to make it square before resampling. This
ensures that the cells of the resulting quadtree will be square. If
<code>FALSE</code>, no <code>NA</code>s are added - the cells in the quadtree will not
be square.</p></dd>


<dt>extent</dt>
<dd><p><code><a href="https://rdrr.io/pkg/raster/man/Extent-class.html" class="external-link">Extent</a></code> object or else a
four-element numeric vector describing the extent of the data (in this
order: xmin, xmax, ymin, ymax). Only used when <code>x</code> is a matrix - this
parameter is ignored if <code>x</code> is a raster since the extent is derived
directly from the raster. If no value is provided and <code>x</code> is a matrix,
the extent is assumed to be <code>c(0,ncol(x),0,nrow(x))</code>.</p></dd>


<dt>projection</dt>
<dd><p>character; string describing the projection of the
data. Only used when <code>x</code> is a matrix - this parameter is ignored if
<code>x</code> is a raster since the proj4ection of the raster is automatically
used. If no value is provided and <code>x</code> is a matrix, the projection of
the quadtree is set to <code>NA</code>.</p></dd>


<dt>proj4string</dt>
<dd><p>deprecated. Use <code>projection</code> instead.</p></dd>


<dt>template_quadtree</dt>
<dd><p><code><a href="Quadtree-class.html">Quadtree</a></code>; if provided, the new
quadtree will be created so that it has the exact same structure as the
template quadtree. Thus, no split function is used because the decision
about whether to split is pre-determined by the template quadtree. The
raster used to create the template quadtree should have the exact same
extent and dimensions as <code>x</code>. If <code>template_quadtree</code> is
non-<code>NULL</code>, all <code>split_</code>* parameters are disregarded, as are
<code>max_cell_length</code> and <code>min_cell_length</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a <code><a href="Quadtree-class.html">Quadtree</a></code></p>


    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The 'quadtree-creation' vignette contains detailed explanations and
  examples for all of the various creation options - run
  <code><a href="../articles/quadtree-creation.html">vignette("quadtree-creation", package = "quadtree")</a></code> to view the
  vignette.</p>
<p>If <code>adj_type</code> is <code>"expand"</code>, <code>NA</code> cells are added to the
  raster in order to create an expanded raster whose dimensions are a power
  of two. The smallest number that is a power of two but greater than the
  larger dimension is used as the dimensions of the expanded raster. If
  <code>adj_type</code> is <code>"resample"</code>, the raster is resampled to a raster
  with <code>resample_n_side</code> rows and columns. If <code>resample_pad_nas</code> is
  <code>TRUE</code>, <code>NA</code> rows or columns are are added to the shorter
  dimension before resampling to make the raster square. This ensures that
  the quadtree cells will be square (assuming the original raster cells were
  square).</p>
<p>When <code>split_method</code> is <code>"range"</code>, the difference between the
  maximum and minimum cell values in a quadrant is calculated - if this value
  is greater than <code>split_threshold</code>, the quadrant is split. When
  <code>split_method</code> is <code>"sd"</code>, the standard deviation of the cell
  values in a quadrant is calculated - if this value is greater than
  <code>split_threshold</code>, the quadrant is split.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">####### NOTE #######</span></span></span>
<span class="r-in"><span><span class="co"># see the "quadtree-creation" vignette for more details and examples of all</span></span></span>
<span class="r-in"><span><span class="co"># the different parameter options:</span></span></span>
<span class="r-in"><span><span class="co"># vignette("quadtree-creation", package = "quadtree")</span></span></span>
<span class="r-in"><span><span class="co">####################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dfriend21/quadtree/" class="external-link">quadtree</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"habitat.tif"</span>, package<span class="op">=</span><span class="st">"quadtree"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">qt</span> <span class="op">&lt;-</span> <span class="fu">quadtree</span><span class="op">(</span><span class="va">habitat</span>, <span class="fl">.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">qt</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="quadtree-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># we can make it look nicer by customizing the plotting parameters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">qt</span>, crop <span class="op">=</span> <span class="cn">TRUE</span>, na_col <span class="op">=</span> <span class="cn">NULL</span>, border_lwd <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="quadtree-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># try a different splitting method</span></span></span>
<span class="r-in"><span><span class="va">qt</span> <span class="op">&lt;-</span> <span class="fu">quadtree</span><span class="op">(</span><span class="va">habitat</span>, <span class="fl">.05</span>, <span class="st">"sd"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">qt</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="quadtree-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- using a custom split function ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># split a cell if any of the values are below a given value</span></span></span>
<span class="r-in"><span><span class="va">split_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">vals</span>, <span class="va">args</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># check for NAs first</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># if there are any NAs we'll split automatically</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">vals</span> <span class="op">&lt;</span> <span class="va">args</span><span class="op">$</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">qt</span> <span class="op">&lt;-</span> <span class="fu">quadtree</span><span class="op">(</span><span class="va">habitat</span>, split_method <span class="op">=</span> <span class="st">"custom"</span>, split_fun <span class="op">=</span> <span class="va">split_fun</span>,</span></span>
<span class="r-in"><span>                split_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">qt</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="quadtree-4.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Derek Friend.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

